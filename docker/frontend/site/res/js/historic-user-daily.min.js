var ROOT_URL="http://internal.axihub.ca/folding",currentDate=new Date,currentUtcDate=new Date(currentDate.getUTCFullYear(),currentDate.getUTCMonth(),currentDate.getUTCDate(),currentDate.getUTCHours(),currentDate.getUTCMinutes(),currentDate.getUTCSeconds()),selectedUserId=0,selectedUser="",selectedMonth=currentUtcDate.getMonth()+1,selectedYear=currentUtcDate.getFullYear(),selectedMonthName=(new Date(selectedYear,selectedMonth-1,1)).toLocaleString("default",{month:"long"});
function getUserHistoricStats(a,c,b,e,d,f){0!=a&&(selectedUserId=a);null!=c&&(selectedUser=c,userDropdownTitle=document.getElementById("user_dropdown_root"),userDropdownTitle.innerHTML=selectedUser);null!=e&&(selectedMonth=e);null!=d&&(selectedMonthName=d,monthDropdownTitle=document.getElementById("month_dropdown_root"),monthDropdownTitle.innerHTML=selectedMonthName);null!=f&&(selectedYear=f,yearDropdownTitle=document.getElementById("year_dropdown_root"),yearDropdownTitle.innerHTML=selectedYear);
""!==selectedUser&&0!==selectedUserId&&(show("loader"),hide("historic_stats"),fetch(ROOT_URL+"/historic/users/"+selectedUserId+"/"+selectedYear+"/"+selectedMonth).then(function(a){return a.json()}).then(function(a){for(historicDiv=document.getElementById("historic_stats");historicDiv.firstChild;)historicDiv.removeChild(historicDiv.lastChild);historicTable=document.createElement("table");historicTable.setAttribute("id","historic_table");historicTable.setAttribute("class","table table-dark table-striped table-hover");
tableHead=document.createElement("thead");tableHeaderRow=document.createElement("tr");["Date","Points","Units"].forEach(function(a,b){tableHeader=document.createElement("th");tableHeader.setAttribute("onclick","sortTable("+b+", 'historic_table')");tableHeader.setAttribute("scope","col");tableHeader.innerHTML=a;tableHeaderRow.append(tableHeader)});tableHead.append(tableHeaderRow);historicTable.append(tableHead);tableBody=document.createElement("tbody");a.forEach(function(a,b){tableRow=document.createElement("tr");
dateCell=document.createElement("td");dateCell.innerHTML=ordinalSuffixOf(a.dateTime.date.day);tableRow.append(dateCell);pointsCell=document.createElement("td");pointsCell.setAttribute("data-bs-toggle","tooltip");pointsCell.setAttribute("data-placement","top");pointsCell.setAttribute("title","Unmultiplied: "+a.points.toLocaleString());pointsCell.innerHTML=a.multipliedPoints.toLocaleString();new bootstrap.Tooltip(pointsCell);tableRow.append(pointsCell);unitsCell=document.createElement("td");unitsCell.innerHTML=
a.units.toLocaleString();tableRow.append(unitsCell);tableBody.append(tableRow)});historicTable.append(tableBody);historicDiv.append(historicTable);hide("loader");show("historic_stats")}))}document.addEventListener("DOMContentLoaded",function(a){populateUserDropdown("user_dropdown");populateMonthDropdown("month_dropdown","getUserHistoricStats");populateYearDropdown("year_dropdown","getUserHistoricStats");updateTimer()});function show(a){document.getElementById(a).style.display="block"}
function hide(a){document.getElementById(a).style.display="none"}var NUMBER_OF_MONTHS=12,NUMBER_OF_YEARS_TO_SHOW=2,YEAR_START=(new Date).getUTCFullYear();
function populateUserDropdown(a){for(var c=document.getElementById(a);c.firstChild;)c.removeChild(c.lastChild);fetch(ROOT_URL+"/users").then(function(a){return a.json()}).then(function(b){userDropdownDiv=document.getElementById(a);b.forEach(function(a,b){userButton=document.createElement("button");userButton.setAttribute("class","dropdown-item");userButton.setAttribute("type","button");userButton.setAttribute("onclick","getUserHistoricStats("+a.id+",'"+a.displayName+"',null,null,null,null)");userButton.innerHTML=
a.displayName;userDropdownDiv.append(userButton)})})}
function populateTeamDropdown(a){for(var c=document.getElementById(a);c.firstChild;)c.removeChild(c.lastChild);fetch(ROOT_URL+"/teams").then(function(a){return a.json()}).then(function(b){teamDropDownDiv=document.getElementById(a);b.forEach(function(a,b){teamButton=document.createElement("button");teamButton.setAttribute("class","dropdown-item");teamButton.setAttribute("type","button");teamButton.setAttribute("onclick","getTeamHistoricStats("+a.id+",'"+a.teamName+"',null,null,null,null)");teamButton.innerHTML=
a.teamName;teamDropDownDiv.append(teamButton)})})}
function populateDayDropdown(a,c,b,e){for(var d=document.getElementById(b);d.firstChild;)d.removeChild(d.lastChild);dayDropdownDiv=document.getElementById(b);a=(new Date(c,a,0)).getDate();selectedDay>a&&(selectedDay=a);for(i=0;i<a;i++)c=ordinalSuffixOf(i+1),dayButton=document.createElement("button"),dayButton.setAttribute("class","dropdown-item"),dayButton.setAttribute("type","button"),dayButton.setAttribute("onclick",e+"(0,null,'"+(i+1)+"',null,null,null)"),dayButton.innerHTML=c,dayDropdownDiv.append(dayButton);
dayDropdownTitle=document.getElementById(b+"_root");dayDropdownTitle.innerHTML=ordinalSuffixOf(selectedDay)}
function populateMonthDropdown(a,c){for(var b=document.getElementById(a);b.firstChild;)b.removeChild(b.lastChild);monthDropdownDiv=document.getElementById(a);for(i=0;i<NUMBER_OF_MONTHS;i++)b=(new Date(YEAR_START,i,1)).toLocaleString("default",{month:"long"}),monthButton=document.createElement("button"),monthButton.setAttribute("class","dropdown-item"),monthButton.setAttribute("type","button"),monthButton.setAttribute("onclick",c+"(0,null,null,"+(i+1)+",'"+b+"',null)"),monthButton.innerHTML=b,monthDropdownDiv.append(monthButton);
monthDropdownTitle=document.getElementById(a+"_root");monthDropdownTitle.innerHTML=selectedMonthName}
function populateYearDropdown(a,c){for(var b=document.getElementById(a);b.firstChild;)b.removeChild(b.lastChild);yearDropdownDiv=document.getElementById(a);for(i=0;i<NUMBER_OF_YEARS_TO_SHOW;i++)b=YEAR_START-i,yearButton=document.createElement("button"),yearButton.setAttribute("class","dropdown-item"),yearButton.setAttribute("type","button"),yearButton.setAttribute("onclick",c+"(0,null,null,null,null,"+b+")"),yearButton.innerHTML=b,yearDropdownDiv.append(yearButton);yearDropdownTitle=document.getElementById(a+
"_root");yearDropdownTitle.innerHTML=selectedYear}function ordinalSuffixOf(a){var c=a%10,b=a%100;return 1==c&&11!=b?a+"st":2==c&&12!=b?a+"nd":3==c&&13!=b?a+"rd":a+"th"}
function sortTable(a,c){var b,e,d,f,g,h,k,l=0;c=document.getElementById(c);e=!0;for(k="asc";e;){e=!1;b=c.rows;for(d=1;d<b.length-1;d++)if(h=!1,f=b[d].getElementsByTagName("TD")[a],g=b[d+1].getElementsByTagName("TD")[a],"asc"==k)if(isNaN(f.innerHTML)||isNaN(g.innerHTML)){if(f.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else{if(parseInt(f.innerHTML)>parseInt(g.innerHTML)){h=!0;break}}else if("desc"==k)if(isNaN(f.innerHTML)||isNaN(g.innerHTML)){if(f.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=
!0;break}}else if(parseInt(f.innerHTML)<parseInt(g.innerHTML)){h=!0;break}h?(b[d].parentNode.insertBefore(b[d+1],b[d]),e=!0,l++):0==l&&"asc"==k&&(k="desc",e=!0)}}var NUMBER_OF_UPDATES_PROPERTY_NAME="numberOfUpdates",UPDATE_MINUTE=55;function startTimer(){calculateNumberOfUpdates();updateTimer()}
function calculateNumberOfUpdates(){if(isStorageAvailable){var a=new Date,c=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),1,0,UPDATE_MINUTE,0,0);seconds=Math.floor((a-c)/1E3);minutes=seconds/60;hours=Math.floor(minutes/60);storageContains(NUMBER_OF_UPDATES_PROPERTY_NAME)&&(a=storageGet(NUMBER_OF_UPDATES_PROPERTY_NAME),a<hours&&(a=hours-a,document.getElementById("toast-update-count").innerHTML=a,showToast("toast-update",!0)));storageSet(NUMBER_OF_UPDATES_PROPERTY_NAME,hours)}else console.log("No local storage available!")}
function updateTimer(){var a=new Date,a=3600-(a.getUTCMinutes()-UPDATE_MINUTE)%60*60-a.getUTCSeconds();minutes=Math.floor(a/60)%60;seconds=a%60;document.getElementById("min-part").innerHTML=minutes;document.getElementById("sec-part").innerHTML=String(seconds).padStart(2,"0");0===minutes&&0===seconds&&showToast("toast-refresh",!1);setTimeout(updateTimer,1E3-(new Date).getUTCMilliseconds())}
function showToast(a,c){(new bootstrap.Toast(document.getElementById(a),{animation:!0,autohide:c,delay:3E3})).show()}function closeToast(a){(new bootstrap.Toast(document.getElementById(a))).dispose()};