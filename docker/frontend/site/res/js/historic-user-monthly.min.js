var ROOT_URL="http://127.0.0.1:8080/folding",selectedUserId=0,selectedUser="",selectedYear=(new Date).getUTCFullYear();
function getUserHistoricStats(a,c,b,f,d,e){0!=a&&(selectedUserId=a);null!=c&&(selectedUser=c,userDropdownTitle=document.getElementById("user_dropdown_root"),userDropdownTitle.innerHTML=selectedUser);null!=e&&(selectedYear=e,yearDropdownTitle=document.getElementById("year_dropdown_root"),yearDropdownTitle.innerHTML=selectedYear);""!==selectedUser&&0!==selectedUserId&&(show("loader"),hide("historic_stats"),fetch(ROOT_URL+"/historic/users/"+selectedUserId+"/"+selectedYear).then(function(a){return a.json()}).then(function(a){for(historicDiv=
document.getElementById("historic_stats");historicDiv.firstChild;)historicDiv.removeChild(historicDiv.lastChild);historicTable=document.createElement("table");historicTable.setAttribute("id","historic_table");historicTable.setAttribute("class","table table-dark table-striped table-hover");tableHead=document.createElement("thead");tableHeaderRow=document.createElement("tr");["Month","Points","Units"].forEach(function(a,b){tableHeader=document.createElement("th");tableHeader.setAttribute("onclick",
"sortTable("+b+", 'historic_table')");tableHeader.setAttribute("scope","col");tableHeader.innerHTML=a;tableHeaderRow.append(tableHeader)});tableHead.append(tableHeaderRow);historicTable.append(tableHead);tableBody=document.createElement("tbody");a.forEach(function(a,b){tableRow=document.createElement("tr");dateCell=document.createElement("td");dateCell.innerHTML=(new Date(e,a.dateTime.date.month-1,"01")).toLocaleString("default",{month:"long"});tableRow.append(dateCell);pointsCell=document.createElement("td");
pointsCell.setAttribute("data-bs-toggle","tooltip");pointsCell.setAttribute("data-placement","top");pointsCell.setAttribute("title","Unmultiplied: "+a.points.toLocaleString());pointsCell.innerHTML=a.multipliedPoints.toLocaleString();new bootstrap.Tooltip(pointsCell);tableRow.append(pointsCell);unitsCell=document.createElement("td");unitsCell.innerHTML=a.units.toLocaleString();tableRow.append(unitsCell);tableBody.append(tableRow)});historicTable.append(tableBody);historicDiv.append(historicTable);
hide("loader");show("historic_stats")}))}document.addEventListener("DOMContentLoaded",function(a){populateUserDropdown("user_dropdown");populateYearDropdown("year_dropdown","getUserHistoricStats");updateTimer()});function show(a){document.getElementById(a).style.display="block"}function showElement(a){a.style.display="block"}function hide(a){document.getElementById(a).style.display="none"}function hideElement(a){a.style.display="none"}var NUMBER_OF_MONTHS=12,NUMBER_OF_YEARS_TO_SHOW=2,YEAR_START=(new Date).getUTCFullYear();
function populateUserDropdown(a){for(var c=document.getElementById(a);c.firstChild;)c.removeChild(c.lastChild);fetch(ROOT_URL+"/users").then(function(a){return a.json()}).then(function(b){userDropdownDiv=document.getElementById(a);b.forEach(function(a,b){userButton=document.createElement("button");userButton.setAttribute("class","dropdown-item");userButton.setAttribute("type","button");b=a.displayName.replace("'","\\'");userButton.setAttribute("onclick","getUserHistoricStats("+a.id+",'"+b+"',null,null,null,null)");
userButton.innerHTML=a.displayName;userDropdownDiv.append(userButton)})})}
function populateTeamDropdown(a){for(var c=document.getElementById(a);c.firstChild;)c.removeChild(c.lastChild);fetch(ROOT_URL+"/teams").then(function(a){return a.json()}).then(function(b){teamDropDownDiv=document.getElementById(a);b.forEach(function(a,b){teamButton=document.createElement("button");teamButton.setAttribute("class","dropdown-item");teamButton.setAttribute("type","button");b=a.teamName.replace("'","\\'");teamButton.setAttribute("onclick","getTeamHistoricStats("+a.id+",'"+b+"',null,null,null,null)");
teamButton.innerHTML=a.teamName;teamDropDownDiv.append(teamButton)})})}
function populateDayDropdown(a,c,b,f){for(var d=document.getElementById(b);d.firstChild;)d.removeChild(d.lastChild);dayDropdownDiv=document.getElementById(b);a=(new Date(c,a,0)).getDate();selectedDay>a&&(selectedDay=a);for(i=0;i<a;i++)c=ordinalSuffixOf(i+1),dayButton=document.createElement("button"),dayButton.setAttribute("class","dropdown-item"),dayButton.setAttribute("type","button"),dayButton.setAttribute("onclick",f+"(0,null,'"+(i+1)+"',null,null,null)"),dayButton.innerHTML=c,dayDropdownDiv.append(dayButton);
dayDropdownTitle=document.getElementById(b+"_root");dayDropdownTitle.innerHTML=ordinalSuffixOf(selectedDay)}
function populateMonthDropdown(a,c){for(var b=document.getElementById(a);b.firstChild;)b.removeChild(b.lastChild);monthDropdownDiv=document.getElementById(a);for(i=0;i<NUMBER_OF_MONTHS;i++)b=(new Date(YEAR_START,i,1)).toLocaleString("default",{month:"long"}),monthButton=document.createElement("button"),monthButton.setAttribute("class","dropdown-item"),monthButton.setAttribute("type","button"),monthButton.setAttribute("onclick",c+"(0,null,null,"+(i+1)+",'"+b+"',null)"),monthButton.innerHTML=b,monthDropdownDiv.append(monthButton);
monthDropdownTitle=document.getElementById(a+"_root");monthDropdownTitle.innerHTML=selectedMonthName}
function populateYearDropdown(a,c){for(var b=document.getElementById(a);b.firstChild;)b.removeChild(b.lastChild);yearDropdownDiv=document.getElementById(a);for(i=0;i<NUMBER_OF_YEARS_TO_SHOW;i++)b=YEAR_START-i,yearButton=document.createElement("button"),yearButton.setAttribute("class","dropdown-item"),yearButton.setAttribute("type","button"),yearButton.setAttribute("onclick",c+"(0,null,null,null,null,"+b+")"),yearButton.innerHTML=b,yearDropdownDiv.append(yearButton);yearDropdownTitle=document.getElementById(a+
"_root");yearDropdownTitle.innerHTML=selectedYear}
function sortTable(a,c){var b,f,d,e,g,h,k,l=0;c=document.getElementById(c);f=!0;for(k="asc";f;){f=!1;b=c.rows;for(d=1;d<b.length-1;d++)if(h=!1,e=b[d].getElementsByTagName("TD")[a],g=b[d+1].getElementsByTagName("TD")[a],"asc"==k)if(isNaN(e.innerHTML)||isNaN(g.innerHTML)){if(e.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else{if(parseInt(e.innerHTML)>parseInt(g.innerHTML)){h=!0;break}}else if("desc"==k)if(isNaN(e.innerHTML)||isNaN(g.innerHTML)){if(e.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=
!0;break}}else if(parseInt(e.innerHTML)<parseInt(g.innerHTML)){h=!0;break}h?(b[d].parentNode.insertBefore(b[d+1],b[d]),f=!0,l++):0==l&&"asc"==k&&(k="desc",f=!0)}}var NUMBER_OF_UPDATES_PROPERTY_NAME="numberOfUpdates",UPDATE_MINUTE=55;function startTimer(){calculateNumberOfUpdates();updateTimer()}
function calculateNumberOfUpdates(){var a=new Date,c=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),1,0,UPDATE_MINUTE,0,0);seconds=Math.floor((a-c)/1E3);minutes=seconds/60;hours=Math.floor(minutes/60);localContains(NUMBER_OF_UPDATES_PROPERTY_NAME)&&(a=localGet(NUMBER_OF_UPDATES_PROPERTY_NAME),a<hours&&(a=hours-a,document.getElementById("toast-update-count-text").innerHTML=1==a?a.toLocaleString()+" update":a.toLocaleString()+" updates",showToast("toast-update",!0)));localSet(NUMBER_OF_UPDATES_PROPERTY_NAME,
hours)}function updateTimer(){var a=new Date,a=3600-(a.getUTCMinutes()-UPDATE_MINUTE)%60*60-a.getUTCSeconds();minutes=Math.floor(a/60)%60;seconds=a%60;document.getElementById("min-part").innerHTML=minutes;document.getElementById("sec-part").innerHTML=String(seconds).padStart(2,"0");0===minutes&&0===seconds&&showToast("toast-refresh",!1);setTimeout(updateTimer,1E3-(new Date).getUTCMilliseconds())}
function showToast(a,c){(new bootstrap.Toast(document.getElementById(a),{animation:!0,autohide:c,delay:3E3})).show()}function closeToast(a){(new bootstrap.Toast(document.getElementById(a))).dispose()}function successToast(a){document.getElementById("toast-success-text").innerHTML=a;showToast("toast-success",!0)}function failureToast(a){document.getElementById("toast-failure-text").innerHTML=a;showToast("toast-failure",!0)};