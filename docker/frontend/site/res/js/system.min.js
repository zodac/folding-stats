var ROOT_URL="http://internal.axihub.ca/folding";function toggleMainButtonStyle(a,b){a=document.getElementById(a);b.contains("collapsed")?(a.classList.add("btn-primary"),a.classList.remove("btn-success")):(a.classList.add("btn-success"),a.classList.remove("btn-primary"))}
function adminLogin(){var a=document.getElementById("login_username").value,b=document.getElementById("login_password").value,c="Basic "+encode(a,b),a=JSON.stringify({encodedUserNameAndPassword:c});show("loader");fetch(ROOT_URL+"/login/admin",{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then(function(a){document.getElementById("login_username").value="";document.getElementById("login_password").value="";hide("loader");200!=a.status?failureToast("Invalid admin credentials!"):
(successToast("Logged in successfully!"),hide("login_form"),show("admin_functions"),sessionSet("Authorization",c))})}
function loadHardware(){fetch(ROOT_URL+"/hardware").then(function(a){return a.json()}).then(function(a){a.sort(sortJsonByKey("id"));var b=["id","hardwareName","displayName","operatingSystem","multiplier"];for(hardwareDiv=document.getElementById("hardware_div");hardwareDiv.firstChild;)hardwareDiv.removeChild(hardwareDiv.lastChild);hardwareTitle=document.createElement("h2");hardwareTitle.setAttribute("class","navbar-brand");hardwareTitle.innerHTML="Hardware";hardwareDiv.append(hardwareTitle);hardwareTable=
document.createElement("table");hardwareTable.setAttribute("id","hardware");hardwareTable.setAttribute("class","table table-dark table-striped table-hover");hardwareTableHead=document.createElement("thead");hardwareTableHeaderRow=document.createElement("tr");["ID","Name","Display Name","Operating System","Multiplier"].forEach(function(a,c){hardwareTableHeader=document.createElement("th");hardwareTableHeader.setAttribute("onclick","sortTable("+c+", 'hardware')");hardwareTableHeader.setAttribute("scope",
"col");hardwareTableHeader.innerHTML=a;hardwareTableHeaderRow.append(hardwareTableHeader)});hardwareTableHead.append(hardwareTableHeaderRow);hardwareTable.append(hardwareTableHead);hardwareTableBody=document.createElement("tbody");a.forEach(function(a,c){hardwareTableBodyRow=document.createElement("tr");b.forEach(function(c,b){hardwareTableBodyCell=document.createElement("td");hardwareTableBodyCell.innerHTML="multiplier"===c?"x"+a[c].toLocaleString():a[c].toLocaleString();hardwareTableBodyRow.append(hardwareTableBodyCell)});
hardwareTableBody.append(hardwareTableBodyRow)});hardwareTable.append(hardwareTableBody);hardwareDiv.append(hardwareTable);a.sort(sortJsonByKey("hardwareName"));hardwareLists=document.querySelectorAll(".hardware_list");for(var c=0,d;d=hardwareLists[c];c++){for(;d.firstChild;)d.removeChild(d.lastChild);defaultHardwareOption=document.createElement("option");defaultHardwareOption.setAttribute("value","");defaultHardwareOption.setAttribute("disabled","");defaultHardwareOption.setAttribute("selected",
"");defaultHardwareOption.innerHTML="Choose Hardware...";d.append(defaultHardwareOption);a.forEach(function(a,c){hardwareOption=document.createElement("option");hardwareOption.setAttribute("value",a.id);hardwareOption.setAttribute("hardware_id",a.id);hardwareOption.setAttribute("hardware_name",a.hardwareName);hardwareOption.setAttribute("display_name",a.displayName);hardwareOption.setAttribute("operating_system",a.operatingSystem);hardwareOption.setAttribute("multiplier",a.multiplier);hardwareOption.innerHTML=
a.displayName+" ("+a.operatingSystem+")";d.append(hardwareOption)})}})}
function loadUsers(){fetch(ROOT_URL+"/users").then(function(a){return a.json()}).then(function(a){a.sort(sortJsonByKey("id"));var b="id displayName foldingUserName passkey category hardwareId profileLink liveStatsLink isRetired".split(" ");for(usersDiv=document.getElementById("users_div");usersDiv.firstChild;)usersDiv.removeChild(usersDiv.lastChild);usersTitle=document.createElement("h2");usersTitle.setAttribute("class","navbar-brand");usersTitle.innerHTML="Users";usersDiv.append(usersTitle);usersTable=
document.createElement("table");usersTable.setAttribute("id","users");usersTable.setAttribute("class","table table-dark table-striped table-hover");usersTableHead=document.createElement("thead");usersTableHeaderRow=document.createElement("tr");"ID;User;Folding Name;Passkey;Category;Hardware ID;Profile Link;Live Stats Link;Retired".split(";").forEach(function(a,b){usersTableHeader=document.createElement("th");usersTableHeader.setAttribute("onclick","sortTable("+b+", 'users')");usersTableHeader.setAttribute("scope",
"col");usersTableHeader.innerHTML=a;usersTableHeaderRow.append(usersTableHeader)});usersTableHead.append(usersTableHeaderRow);usersTable.append(usersTableHead);usersTableBody=document.createElement("tbody");dataListOfUsers=document.getElementById("available_users");selectOfUsers=document.getElementById("create_team_users");a.forEach(function(a,d){usersTableBodyRow=document.createElement("tr");b.forEach(function(b,c){usersTableBodyCell=document.createElement("td");"liveStatsLink"===b||"profileLink"===
b?b in a&&(link=document.createElement("a"),link.setAttribute("href",a[b]),link.innerHTML=a[b],usersTableBodyCell.append(link)):b in a&&(usersTableBodyCell.innerHTML=a[b].toLocaleString());usersTableBodyRow.append(usersTableBodyCell)});usersTableBody.append(usersTableBodyRow);d=document.createElement("option");d.setAttribute("value",a.id);d.innerHTML=a.displayName;dataListOfUsers.append(d);d=document.createElement("option");d.setAttribute("value",a.id);d.innerHTML=a.displayName;selectOfUsers.append(d)});
usersTable.append(usersTableBody);usersDiv.append(usersTable)})}
function loadTeams(){fetch(ROOT_URL+"/teams").then(function(a){return a.json()}).then(function(a){a.sort(sortJsonByKey("id"));var b="id teamName teamDescription forumLink captainUserId userIds retiredUserIds".split(" ");for(teamsDiv=document.getElementById("teams_div");teamsDiv.firstChild;)teamsDiv.removeChild(teamsDiv.lastChild);teamsTitle=document.createElement("h2");teamsTitle.setAttribute("class","navbar-brand");teamsTitle.innerHTML="Teams";teamsDiv.append(teamsTitle);teamsTable=document.createElement("table");
teamsTable.setAttribute("id","teams");teamsTable.setAttribute("class","table table-dark table-striped table-hover");teamsTableHead=document.createElement("thead");teamsTableHeaderRow=document.createElement("tr");"ID;Name;Description;Forum Link;Captain ID;User IDs;Retired User IDs".split(";").forEach(function(a,b){teamsTableHeader=document.createElement("th");teamsTableHeader.setAttribute("onclick","sortTable("+b+", 'teams')");teamsTableHeader.setAttribute("scope","col");teamsTableHeader.innerHTML=
a;teamsTableHeaderRow.append(teamsTableHeader)});teamsTableHead.append(teamsTableHeaderRow);teamsTable.append(teamsTableHead);teamsTableBody=document.createElement("tbody");a.forEach(function(a,d){teamsTableBodyRow=document.createElement("tr");b.forEach(function(b,c){teamsTableBodyCell=document.createElement("td");"forumLink"===b?b in a&&(link=document.createElement("a"),link.setAttribute("href",a[b]),link.setAttribute("target","_blank"),link.innerHTML=a[b],teamsTableBodyCell.append(link)):b in a&&
(teamsTableBodyCell.innerHTML=a[b].toLocaleString());teamsTableBodyRow.append(teamsTableBodyCell)});teamsTableBody.append(teamsTableBodyRow)});teamsTable.append(teamsTableBody);teamsDiv.append(teamsTable)})}
function populateHardwareUpdate(){show("loader");element=document.getElementById("hardware_update_selector");selectedElement=element.options[element.selectedIndex];document.getElementById("hardware_update_id").value=selectedElement.getAttribute("hardware_id");document.getElementById("hardware_update_name").value=selectedElement.getAttribute("hardware_name");document.getElementById("hardware_update_display_name").value=selectedElement.getAttribute("display_name");document.getElementById("hardware_update_operating_system").value=
selectedElement.getAttribute("operating_system");document.getElementById("hardware_update_multiplier").value=selectedElement.getAttribute("multiplier");hardwareFields=document.querySelectorAll(".hardware_update");for(var a=0,b;b=hardwareFields[a];a++)showElement(b);hide("loader")}
function populateHardwareDelete(){show("loader");element=document.getElementById("hardware_delete_selector");selectedElement=element.options[element.selectedIndex];document.getElementById("hardware_delete_id").value=selectedElement.getAttribute("hardware_id");document.getElementById("hardware_delete_name").value=selectedElement.getAttribute("hardware_name");document.getElementById("hardware_delete_display_name").value=selectedElement.getAttribute("display_name");document.getElementById("hardware_delete_operating_system").value=
selectedElement.getAttribute("operating_system");document.getElementById("hardware_delete_multiplier").value=selectedElement.getAttribute("multiplier");hardwareFields=document.querySelectorAll(".hardware_delete");for(var a=0,b;b=hardwareFields[a];a++)showElement(b);hide("loader")}
function createHardware(){var a=document.getElementById("hardware_create_name").value.trim(),b=document.getElementById("hardware_create_display_name").value.trim(),c=document.getElementById("hardware_create_operating_system").value.trim(),d=document.getElementById("hardware_create_multiplier").value.trim(),a=JSON.stringify({hardwareName:a,displayName:b,operatingSystem:c,multiplier:d});show("loader");fetch(ROOT_URL+"/hardware",{method:"POST",headers:{"Content-Type":"application/json",Authorization:sessionGet("Authorization")},
body:a}).then(function(a){hide("loader");if(201!=a.status)throw failureToast("Hardware create failed with code: "+a.status),Error("Hardware create failed with code: "+a.status+": "+a.json);document.getElementById("hardware_create_name").value="";document.getElementById("hardware_create_display_name").value="";document.getElementById("hardware_create_operating_system").value="";document.getElementById("hardware_create_multiplier").value="";successToast("Hardware '"+b+"' created");loadHardware()})}
function updateHardware(){var a=document.getElementById("hardware_update_selector"),a=document.getElementById("hardware_update_selector");selectedElement=a.options[a.selectedIndex];var a=selectedElement.getAttribute("hardware_id"),b=document.getElementById("hardware_update_name").value.trim(),c=document.getElementById("hardware_update_display_name").value.trim(),d=document.getElementById("hardware_update_operating_system").value.trim(),e=document.getElementById("hardware_update_multiplier").value.trim(),
b=JSON.stringify({hardwareName:b,displayName:c,operatingSystem:d,multiplier:e});console.log("Updating "+a+", payload: "+b);show("loader");fetch(ROOT_URL+"/hardware/"+a,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:sessionGet("Authorization")},body:b}).then(function(a){hide("loader");if(200!=a.status)throw failureToast("Hardware update failed with code: "+a.status),Error("Hardware update failed with code: "+a.status+": "+a.json);document.getElementById("hardware_update_name").value=
"";document.getElementById("hardware_update_display_name").value="";document.getElementById("hardware_update_operating_system").value="";document.getElementById("hardware_update_multiplier").value="";successToast("Hardware '"+c+"' updated");loadHardware()})}
function deleteHardware(){var a=document.getElementById("hardware_delete_selector"),a=document.getElementById("hardware_delete_selector");selectedElement=a.options[a.selectedIndex];var a=selectedElement.getAttribute("hardware_id"),b=selectedElement.getAttribute("hardware_name");show("loader");fetch(ROOT_URL+"/hardware/"+a,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:sessionGet("Authorization")}}).then(function(a){hide("loader");if(200!=a.status)throw failureToast("Hardware delete failed with code: "+
a.status),Error("Hardware delete failed with code: "+a.status+": "+a.json);document.getElementById("hardware_delete_id").value="";document.getElementById("hardware_delete_name").value="";document.getElementById("hardware_delete_display_name").value="";document.getElementById("hardware_delete_operating_system").value="";document.getElementById("hardware_delete_multiplier").value="";hardwareFields=document.querySelectorAll(".hardware_delete");a=0;for(var c;c=hardwareFields[a];a++)hideElement(c);successToast("Hardware '"+
b+"' deleted");loadHardware()})}document.addEventListener("DOMContentLoaded",function(a){sessionContains("Authorization")&&(hide("login_form"),show("admin_functions"));loadHardware();loadUsers();loadTeams();updateTimer();hide("loader")});function show(a){document.getElementById(a).style.display="block"}function showElement(a){a.style.display="block"}function hide(a){document.getElementById(a).style.display="none"}function hideElement(a){a.style.display="none"}
function encode(a,b){return btoa(a+":"+b)}function sortJsonByKey(a){return function(b,c){return b[a]>c[a]?1:b[a]<c[a]?-1:0}}function localGet(a){return localStorage.getItem(a)}function localSet(a,b){localStorage.setItem(a,b)}function localContains(a){return null!==localGet(a)}function sessionGet(a){return sessionStorage.getItem(a)}function sessionSet(a,b){sessionStorage.setItem(a,b)}function sessionContains(a){return null!==sessionGet(a)}
function sortTable(a,b){var c,d,e,f,g,h,k,l=0;b=document.getElementById(b);d=!0;for(k="asc";d;){d=!1;c=b.rows;for(e=1;e<c.length-1;e++)if(h=!1,f=c[e].getElementsByTagName("TD")[a],g=c[e+1].getElementsByTagName("TD")[a],"asc"==k)if(isNaN(f.innerHTML)||isNaN(g.innerHTML)){if(f.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else{if(parseInt(f.innerHTML)>parseInt(g.innerHTML)){h=!0;break}}else if("desc"==k)if(isNaN(f.innerHTML)||isNaN(g.innerHTML)){if(f.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=
!0;break}}else if(parseInt(f.innerHTML)<parseInt(g.innerHTML)){h=!0;break}h?(c[e].parentNode.insertBefore(c[e+1],c[e]),d=!0,l++):0==l&&"asc"==k&&(k="desc",d=!0)}}var NUMBER_OF_UPDATES_PROPERTY_NAME="numberOfUpdates",UPDATE_MINUTE=55;function startTimer(){calculateNumberOfUpdates();updateTimer()}
function calculateNumberOfUpdates(){var a=new Date,b=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),1,0,UPDATE_MINUTE,0,0);seconds=Math.floor((a-b)/1E3);minutes=seconds/60;hours=Math.floor(minutes/60);localContains(NUMBER_OF_UPDATES_PROPERTY_NAME)&&(a=localGet(NUMBER_OF_UPDATES_PROPERTY_NAME),a<hours&&(a=hours-a,document.getElementById("toast-update-count-text").innerHTML=1==a?a.toLocaleString()+" update":a.toLocaleString()+" updates",showToast("toast-update",!0)));localSet(NUMBER_OF_UPDATES_PROPERTY_NAME,
hours)}function updateTimer(){var a=new Date,a=3600-(a.getUTCMinutes()-UPDATE_MINUTE)%60*60-a.getUTCSeconds();minutes=Math.floor(a/60)%60;seconds=a%60;document.getElementById("min-part").innerHTML=minutes;document.getElementById("sec-part").innerHTML=String(seconds).padStart(2,"0");0===minutes&&0===seconds&&showToast("toast-refresh",!1);setTimeout(updateTimer,1E3-(new Date).getUTCMilliseconds())}
function showToast(a,b){(new bootstrap.Toast(document.getElementById(a),{animation:!0,autohide:b,delay:3E3})).show()}function closeToast(a){(new bootstrap.Toast(document.getElementById(a))).dispose()}function successToast(a){document.getElementById("toast-success-text").innerHTML=a;showToast("toast-success",!0)}function failureToast(a){document.getElementById("toast-failure-text").innerHTML=a;showToast("toast-failure",!0)};